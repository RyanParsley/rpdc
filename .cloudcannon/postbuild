#!/bin/bash

# CloudCannon Postbuild Hook - POSSE Syndication Validation
# This hook validates that POSSE syndication worked correctly
# SYNC_PATHS in cloudcannon.config.yml handles committing changes

echo "ðŸ”„ CloudCannon Postbuild: Validating POSSE syndication..."

# Check if ephemera directory exists
EPHEMERA_DIR="src/content/ephemera"
if [ ! -d "$EPHEMERA_DIR" ]; then
    echo "â„¹ï¸  Ephemera directory not found: $EPHEMERA_DIR"
    echo "âœ¨ CloudCannon Postbuild: Complete"
    exit 0
fi

# Count ephemera files with syndication links
SYNDICATION_COUNT=$(grep -r "syndication:" "$EPHEMERA_DIR" 2>/dev/null | wc -l)

if [ "$SYNDICATION_COUNT" -gt 0 ]; then
    echo "âœ… Found $SYNDICATION_COUNT ephemera posts with syndication links"
    echo "ðŸ“ SYNC_PATHS will automatically commit these changes to the repository"
    echo "ðŸ”„ Changes will be synced back to your GitHub repository"
else
    echo "â„¹ï¸  No syndicated posts found (this may be normal if no recent posts were processed)"
fi

# Check for any ephemera files (to ensure the directory structure is correct)
EPHEMERA_FILE_COUNT=$(find "$EPHEMERA_DIR" -name "*.md" 2>/dev/null | wc -l)
echo "ðŸ“Š Total ephemera files: $EPHEMERA_FILE_COUNT"

echo "âœ¨ CloudCannon Postbuild: Validation Complete"
echo "ðŸ’¡ SYNC_PATHS will handle committing any changes back to your repository"
