#!/bin/bash

#!/bin/bash

# CloudCannon Postbuild Hook - POSSE Syndication Validation
# Git operations are handled directly by the POSSE integration during build

echo "ğŸ”„ CloudCannon Postbuild: Validating POSSE syndication..."

# Check if ephemera directory exists
EPHEMERA_DIR="src/content/ephemera"
if [ ! -d "$EPHEMERA_DIR" ]; then
    echo "â„¹ï¸  Ephemera directory not found: $EPHEMERA_DIR"
    echo "âœ¨ CloudCannon Postbuild: Complete"
    exit 0
fi

# Count ephemera files with syndication links
SYNDICATION_COUNT=$(grep -r "syndication:" "$EPHEMERA_DIR" 2>/dev/null | wc -l)
echo "ğŸ“Š Syndication links found: $SYNDICATION_COUNT"

# Check total ephemera files
EPHEMERA_FILE_COUNT=$(find "$EPHEMERA_DIR" -name "*.md" 2>/dev/null | wc -l)
echo "ğŸ“Š Total ephemera files: $EPHEMERA_FILE_COUNT"

# Check for recent ephemera files (last 24 hours)
RECENT_FILES=$(find "$EPHEMERA_DIR" -name "*.md" -mtime -1 2>/dev/null | wc -l)
echo "ğŸ“Š Recent ephemera files (24h): $RECENT_FILES"

if [ "$SYNDICATION_COUNT" -gt 0 ]; then
    echo "âœ… POSSE syndication completed successfully"
    echo "ğŸ“ Changes have been committed and pushed to GitHub during the build process"
    echo "ğŸ”„ No additional sync needed - git operations handled by POSSE integration"
elif [ "$RECENT_FILES" -gt 0 ]; then
    echo "âš ï¸  Recent ephemera files found but no syndication links detected"
    echo "ğŸ” This may indicate POSSE processing didn't complete or failed"
else
    echo "â„¹ï¸  No recent ephemera posts to syndicate (this is normal)"
fi

echo "âœ¨ CloudCannon Postbuild: Validation Complete"
